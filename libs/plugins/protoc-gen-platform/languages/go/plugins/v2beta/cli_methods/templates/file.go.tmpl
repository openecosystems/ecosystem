// Code generated by protoc-gen-platform {{ pluginName }}. DO NOT EDIT.
// source: {{ .File.InputPath }}
{{ $s := service .File }}{{ $version := getPackageVersionName .File }}{{ $versionLower := getPackageVersion .File }}{{ $apiType := getApiOptionsTypeName .File }}{{ $system := domainSystemName2 .File }}{{ $e := parentEntity . }}{{ $entityName := entityName $e }}{{ $entityNamePlural := entityNamePlural $e}}{{ $leadingComment := methodLeadingComment . }}{{ $trailingComments := methodTrailingComment . }}{{ $leadingDetachedComments := methodLeadingDetachedComments . }}{{ $methodShortName := getMethodShortName . }}
{{ $systemlower := toLower $system }}

package {{ goPath .File }}cli

import (
    "encoding/json"
    "os"

    "google.golang.org/protobuf/encoding/protojson"
    "github.com/spf13/cobra"
    clog "github.com/charmbracelet/log"

    cli "github.com/adino/platform/apps/clients/public/cli/v2alpha/adino/cli"
    sdkv2betalib "github.com/openecosystems/ecosystem/go/oeco-sdk/v2beta"
    "github.com/adino/platform/apps/clients/public/cli/v2alpha/adino/utils"
    adinosdkv2beta "github.com/adino/platform/go/adino-sdk/v2beta"

{{ range getImportPackages .File }}
    "{{ . }}"
{{ end }}
)

var (
  {{ .Name.LowerCamelCase }}Request string
  {{ .Name.LowerCamelCase }}FieldMask   string
  {{ .Name.LowerCamelCase }}ValidateOnly bool
)

var {{ .Name }}{{ $version.UpperCamelCase }}Cmd = &cobra.Command{
    Use:   "{{ $methodShortName.LowerCamelCase }}",
    Short: `{{- $leadingComment -}}`,
    Long:  `{{- $leadingDetachedComments -}}`,
    Run: func(cmd *cobra.Command, args []string) {
        log := cmd.Context().Value(sdkv2betalib.LoggerContextKey).(*clog.Logger)
        adino := cmd.Context().Value(cli.AdinoSDKContextKey).(*adinosdkv2beta.AdinoClient)
        log.Debug("Calling {{ .Name.LowerCamelCase }} {{ $entityName.LowerCamelCase }}")

		params, err := cliutils.ExtractParameters(cmd, args)
		if err != nil {
			log.Error(err)
			os.Exit(1)
		}

        request := {{ goPath .File }}.{{ .Input.Name.UpperCamelCase }}{}
        err = protojson.Unmarshal([]byte(params.Request), &request)
        if err != nil {
            log.Error(err)
            os.Exit(1)
        }

        {{- if eq (getCqrsType . ) "stream-server" }} // server streaming
        err = adino.{{ $system }}.{{ $s.Name.UpperCamelCase }}.{{ .Name.UpperCamelCase }}(cmd.Context(), &request, func(msg *{{ goPath .File }}.{{ .Output.Name.UpperCamelCase }}) {
            log.Info("Received {{ .Output.Name.UpperCamelCase }}:", msg)
            val, _ := json.MarshalIndent(&msg, "", "    ")
            log.Info(string(val))
        })
        if err != nil {
            log.Fatal(err)
        }
        {{- else if eq (getCqrsType . ) "stream-bidi" }} // bidi streaming

        {{- else }} // unary
        response, err := adino.{{ $system }}.{{ $s.Name.UpperCamelCase }}.{{ .Name.UpperCamelCase }}(cmd.Context(), &request, params.CallOptions...)
        if err != nil {
            log.Error(err)
            os.Exit(1)
        }

        val, _ := json.MarshalIndent(&response, "", "    ")
        log.Info(string(val))
        {{ end -}}


    },
}

func init() {
  {{ .Name }}{{ $version.UpperCamelCase }}Cmd.PersistentFlags().StringVarP(&{{ .Name.LowerCamelCase }}Request, "request", "r", "{}", "Request for api call")
  {{ .Name }}{{ $version.UpperCamelCase }}Cmd.PersistentFlags().BoolVar(&{{ .Name.LowerCamelCase }}ValidateOnly,"validate-only", false, "Only validate this request without modifying the resource")
  {{ .Name }}{{ $version.UpperCamelCase }}Cmd.PersistentFlags().StringVarP(&{{ .Name.LowerCamelCase }}FieldMask, "field-mask", "m", "", "Limit the returned response fields")
}
